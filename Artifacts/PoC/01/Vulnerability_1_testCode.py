import socket
import ssl
import json

HOST = 'localhost'
PORT = 2222

json_key_list = ['PlateNumber' , 'Status' , 'RegistrationExpiration', 'OwnerName' , 'OwnerBirth' , 'OwnerAddress' , 'OwnerZipCode' , 'VehicleYearOfManufacture' , 'VehicleMake' , 'VehicleModel' , 'VehicleColor']

server_sni_hostname = 'example.com'
server_cert = 'rootca.crt'

context = ssl.create_default_context(ssl.Purpose.SERVER_AUTH, cafile=server_cert)
context.check_hostname = False
context.load_verify_locations('rootca.crt')

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
conn = context.wrap_socket(s, server_side=False, server_hostname=server_sni_hostname)
conn.connect((HOST, PORT))
print("SSL established. Peer: {}".format(conn.getpeercert()))
while True:
    
    vehicleInfo = []
    vehicleInfo_json = {}

    plateNumber = input("Please input Plate number : ")
    
    sendMsgHdr=(len(plateNumber)+1)
    sendMsgHdr2=sendMsgHdr.to_bytes(2, 'big')

    conn.sendall(sendMsgHdr2)
    conn.sendall(plateNumber.encode('utf-8'))
    data = conn.recv(1024)
    if data != b'\x00\x00' :
        data = conn.recv(1024)
        data=data.decode('utf-8')
        print(data)
        vehicleInfo = data.split('\n')
        vehicleInfo_json = dict( zip(json_key_list, vehicleInfo) )
        json.dumps(vehicleInfo_json)
        
        print(vehicleInfo_json)

conn.close()

